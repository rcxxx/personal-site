<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="Rcxxx's Notes Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="Rcxxx's Notes Blog Atom Feed">
<link rel="stylesheet" href="katex/v0.12.0/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">swiftUI 截取屏幕图像 | Rcxxx&#x27;s Notes</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="swiftUI 截取屏幕图像 | Rcxxx&#x27;s Notes"><meta data-react-helmet="true" name="description" content="测试环境"><meta data-react-helmet="true" property="og:description" content="测试环境"><meta data-react-helmet="true" property="og:url" content="https://github.com/rcxxx/docs//docs/docs/ios/swiftUI/swiftUI-screen-shot"><link data-react-helmet="true" rel="shortcut icon" href="/docs/img/icons/lzumi-icon-05-128x128.jpg"><link data-react-helmet="true" rel="canonical" href="https://github.com/rcxxx/docs//docs/docs/ios/swiftUI/swiftUI-screen-shot"><link rel="stylesheet" href="/docs/styles.78be3478.css">
<link rel="preload" href="/docs/styles.5cb6a75a.js" as="script">
<link rel="preload" href="/docs/runtime~main.eb589c99.js" as="script">
<link rel="preload" href="/docs/main.d8999595.js" as="script">
<link rel="preload" href="/docs/1.5de7ee7f.js" as="script">
<link rel="preload" href="/docs/2.cda0db80.js" as="script">
<link rel="preload" href="/docs/111.bd71c2f7.js" as="script">
<link rel="preload" href="/docs/113.9931715d.js" as="script">
<link rel="preload" href="/docs/935f2afb.daa1501e.js" as="script">
<link rel="preload" href="/docs/17896441.110d4dda.js" as="script">
<link rel="preload" href="/docs/d6e0f890.9dee84b1.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docs/"><img src="/docs/img/icons/konosuba-01.png" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/docs/img/icons/konosuba-01.png" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Home</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/docs/">README</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">💻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/docs/cc/cc-classes-and-objects">C/C++</a></li><li><a class="dropdown__link">Python</a></li><li><a class="dropdown__link" href="/docs/docs/data-structures/大话数据结构/data-structures-introduction">数据结构</a></li><li><a class="dropdown__link" href="/docs/docs/design-pattern/design-pattern-UML-class-diagram">设计模式</a></li><li><a class="dropdown__link" href="/docs/docs/ios/ios-about-xcode">ios</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">🧠Interesting</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/docs/AI/about-AI">ML &amp; DL</a></li><li><a class="dropdown__link" href="/docs/docs/opencv/about-opencv">opencv</a></li><li><a class="dropdown__link" href="/docs/docs/pytorch/about-pytorch">pytorch</a></li><li><a class="dropdown__link">tensorflow</a></li><li><a class="dropdown__link" href="/docs/docs/yolo/yolov5-start">yolo</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">👽robot</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/docs/robocon/about-rc">RoboCon</a></li><li><a class="dropdown__link" href="/docs/docs/robomaster/about-rm">RoboMaster</a></li><li><a class="dropdown__link" href="/docs/docs/ros/ros-install">ROS</a></li><li><a class="dropdown__link" href="/docs/docs/point-cloud/PCL/pcl-install">Point Cloud</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">👾project</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/docs/project/毕业设计/graduation-project">毕业设计</a></li><li><a class="dropdown__link" href="/docs/docs/project/车道线检测/about-lane-detection">车道线检测</a></li><li><a class="dropdown__link" href="/docs/docs/project/3D打印延时摄影/raspberry-pi-octoprint">3D打印延时摄影</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">🎮</a><ul class="dropdown__menu"><li><a class="dropdown__link">就知道玩</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">🍻</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/docs/life/foods/always-eating">就知道吃</a></li></ul></div><a href="https://github.com/rcxxx/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">本站源码</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk" style="margin-left:2px">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk" style="margin-left:1px">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs/"><img src="/docs/img/icons/konosuba-01.png" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/docs/img/icons/konosuba-01.png" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Home</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/docs/">README</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">💻</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/docs/cc/cc-classes-and-objects">C/C++</a></li><li class="menu__list-item"><a class="menu__link">Python</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/data-structures/大话数据结构/data-structures-introduction">数据结构</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/design-pattern/design-pattern-UML-class-diagram">设计模式</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/ios/ios-about-xcode">ios</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">🧠Interesting</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/docs/AI/about-AI">ML &amp; DL</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/opencv/about-opencv">opencv</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/pytorch/about-pytorch">pytorch</a></li><li class="menu__list-item"><a class="menu__link">tensorflow</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/yolo/yolov5-start">yolo</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">👽robot</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/docs/robocon/about-rc">RoboCon</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/robomaster/about-rm">RoboMaster</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/ros/ros-install">ROS</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/point-cloud/PCL/pcl-install">Point Cloud</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">👾project</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/docs/project/毕业设计/graduation-project">毕业设计</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/project/车道线检测/about-lane-detection">车道线检测</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docs/project/3D打印延时摄影/raspberry-pi-octoprint">3D打印延时摄影</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">🎮</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link">就知道玩</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">🍻</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/docs/life/foods/always-eating">就知道吃</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/rcxxx/docs" target="_blank" rel="noopener noreferrer" class="menu__link">本站源码</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy sidebarWithHideableNavbar_CROi"><a tabindex="-1" class="sidebarLogo_xFc8" href="/docs/"><img src="/docs/img/icons/konosuba-01.png" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI"><img src="/docs/img/icons/konosuba-01.png" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp"><strong>Home</strong></a><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">C/C++</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">面对对象</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-classes-and-objects">类和对象</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-classes-and-objects-2">特性</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-generic-and-template">函数模板</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-generic-and-template-2">类模板</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-classes-virtual-function">虚函数</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">C++11</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-unified-init">统一的初始化</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-auto">auto、decltype</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-nullptr">nullptr</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-using">模板别名</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-new-for">循环</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-auto-ptr">智能指针</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-lambda">lambda 表达式</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-files-and-exceptions">文件与异常</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-11-scope-enum">作用域内枚举</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">More Effective C++</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/effective_cc/distinguish-pointers-reference">指针和引用</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">boost</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/cc/cc-boost-install">install</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">数据结构与算法</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">大话数据结构读书笔记</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/data-structures/大话数据结构/data-structures-introduction">第一章 数据结构绪论</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">第二章 算法</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/data-structures/大话数据结构/data-structures-algorithm">算法-1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/data-structures/大话数据结构/data-structures-algorithm-2">算法-2</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">第三章 线性表</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/data-structures/大话数据结构/data-structures-list">线性表-1</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">🗡剑指Offer笔记</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/data-structures/剑指offer/常见数据结构">简单复习数据结构</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/data-structures/剑指offer/赋值运算符函数">面试题1</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">设计模式</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/design-pattern/design-pattern-UML-class-diagram">UML 类图</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">ios</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/ios/ios-about-xcode">简单了解 XCode</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/ios/ios-reference-data">参考资料汇总</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">swift</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/ios/swift/swift-optional">「!」 and 「?」</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">swiftUI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/ios/swiftUI/swiftUI-show-web-pages">WKWebView</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/docs/ios/swiftUI/swiftUI-screen-shot">Screen Shot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docs/ios/swiftUI/swiftUI-ReplayKit">ReplayKit</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">开发环境配置</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/tutorials/about-vscode">vscode</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2WRA"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_CoMu"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">swiftUI 截取屏幕图像</h1></header><div class="markdown"><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="测试环境"></a>测试环境<a class="hash-link" href="#测试环境" title="Direct link to heading">#</a></h3><table><thead><tr><th>名称</th><th>内容</th></tr></thead><tbody><tr><td>系统版本</td><td>macOS Big Sur 11.2.2</td></tr><tr><td><code>XCode</code></td><td>12.4 (12D4e)</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="功能实现"></a>功能实现<a class="hash-link" href="#功能实现" title="Direct link to heading">#</a></h3><ul><li>先在 <code>XCoed</code> 新建一个工程，取名 <code>ScreenShot-Demo</code></li></ul><p>要实现截图功能，首先得显示图像，方便起见，直接使用 <code>Show-Web-Page</code> 工程的代码</p><ul><li><a href="https://sinnammanyo.cn/docs/docs/ios/swiftUI/swiftUI-show-web-pages" target="_blank" rel="noopener noreferrer">传送门</a></li></ul><p>显示内容部分解决</p><p>接下来是实现截图功能</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>💡</h5></div><div class="admonition-content"><p>开始实现功能之前我们先对 <strong><code>Info.plist</code></strong> 进行一下设置</p><p>我们希望将截取到的图像保存到相册中，则需要获取访问相册的权限</p></div></div><p>打开 <code>Info.plist</code></p><p>在 <code>Key</code> 一栏中的 <code>Informatica Property List</code> 处添加一个新的选项</p><p>下拉选项中选中 <code>Privacy - Photo Library Usage Description</code></p><p><code>value</code> 栏中填入 <code>Photo Library Permission</code></p><p>保存即可，接下来当使用截图功能的时候，会询问是否给 APP 相应的权限</p><p>这里不设置的话截图保存的时候程序就会崩溃</p><hr><p><strong>准备工作完成，开始实现</strong></p><p>继续在 <code>myWebView</code> 结构体中新建一个函数，函数返回类型为 <code>UIImage</code> ，并且可以通过传入参数 <code>shouldSave</code> 控制是否将截图保存至相册中</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">func takescreenShot(_ shouldSave: Bool = false) -&gt; UIImage? {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var screenshotImage :UIImage?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    let layer = UIApplication.shared.keyWindow!.layer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    let scale = UIScreen.main.scale</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    UIGraphicsBeginImageContextWithOptions(layer.frame.size, false, scale);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    guard let context = UIGraphicsGetCurrentContext() else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return nil</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    layer.render(in:context)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    screenshotImage = UIGraphicsGetImageFromCurrentImageContext()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    UIGraphicsEndImageContext()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if let image = screenshotImage, shouldSave {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        UIImageWriteToSavedPhotosAlbum(image, nil, nil, nil)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return screenshotImage</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>详细解释下函数的实现</p><ul><li><p>创建一个新的图像背景
<code>UIGraphicsBeginImageContextWithOptions(layer.frame.size, false, scale);</code></p><ul><li>UIGraphicsBeginImageContextWithOptions 可以通过 scale 调整比例因子，有关 API 的更详细内容可以在 <code>Developer Documentation</code> 中查看</li></ul></li><li><p>将图层渲染到背景中</p></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">guard let context = UIGraphicsGetCurrentContext() else {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return nil</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">layer.render(in:context)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li>将背景赋值到 <code>UIImage</code> 变量中</li></ul><p><code>screenshotImage = UIGraphicsGetImageFromCurrentImageContext()</code></p><ul><li>删除背景</li></ul><p><code>UIGraphicsEndImageContext()</code></p><ul><li>如果 <code>shouldSave</code> 为 <code>true</code> ，则将截图保存到相册</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">if let image = screenshotImage, shouldSave {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    UIImageWriteToSavedPhotosAlbum(image, nil, nil, nil)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><p><code>shouldSave</code> 有默认值为 <code>false</code></p></li><li><p>最后将 <code>screenshotImage</code> 作为参数返回</p></li></ul><p>至此实现截图功能的函数就已经完成了，本质上就是创建一个当前屏幕图像的复制，然后存储到相册或是需要的变量中</p><p>之后在主窗体的 <code>body</code> 中新建一个 <code>botton</code> 用来激活截图功能，在 <code>botton</code> 中调用截图函数</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Button(&quot;Screen Shot&quot;) {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    self.screenshotImage = view.takescreenShot(true)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">.padding()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">.background(Color.gray)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">.cornerRadius(15)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">.foregroundColor(Color.white)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>调用函数之前先在主窗体最外面一层创建一个变量用来保存截图的返回值</p><p><code>@State var screenshotImage :UIImage? = nil</code></p><p>然后将 <code>botton</code> 和 <code>view</code> 放置在一个 <code>VStack</code> 中， <code>VStack</code> 会将控件垂直排列</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">var body: some View {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    VStack {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self.view.ignoresSafeArea()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        Button(&quot;Capture&quot;) {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            ...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        ...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>画布中预览，可以看到 <code>WebView</code> 与 <code>botton</code>  呈垂直排列</p><p><img src="https://pictures-1304295136.cos.ap-guangzhou.myqcloud.com/screenshot/macOS/screen-shot-canvans.png"></p><p>点击 <code>botton</code> 后没有反应，是正常的，因为只是在画布中预览，接下来打开 <code>simulator</code> 进行测试</p><p>在 <code>XCode</code> 窗口顶部，工程名称的旁边，可以选择想要打开的模拟器的机器型号，这里选择 <code>iphone 12</code></p><p>选择好之后 <code>cmd + B</code> 编译工程，成功后 <code>cmd + R</code> 运行，等待模拟器打开，进行测试</p><p>点击 <code>Screen Shot</code> 后出现如下界面，就是前面提到的权限问题</p><p><img src="https://pictures-1304295136.cos.ap-guangzhou.myqcloud.com/screenshot/macOS/screen-shot-photo-library-permission.png"></p><p>选择 <code>Allow Access to All Photos</code> 允许访问所有相册</p><p>之后就可以正常截图了，换不同的位置多截几张</p><p>然后来到相册中，成功看到刚才的截图内容</p><p><img src="https://pictures-1304295136.cos.ap-guangzhou.myqcloud.com/screenshot/macOS/screen-shot-albums.png"></p><p>大功告成······</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="方案二"></a>方案二<a class="hash-link" href="#方案二" title="Direct link to heading">#</a></h3><p>之前尝试用 <code>SWViewCapture</code> 来实现截图功能，总是出现 <code>crash</code> ，困扰了我很久，在网上找了很久也是没有头绪，结合上面的实现，推测可能是权限的问题，这里将权限设置好之后再来试着实现一下</p><p>要使用封装好的第三方库，需要将第三方库的 <code>.xcodeproj</code> 目录直接复制到工程根目录下</p><p>在 <a href="https://github.com/startry/SwViewCapture" target="_blank" rel="noopener noreferrer">startry/SwViewCapture</a> 仓库中找到 <code>SwViewCapture.xcodeproj</code>，复制到工程目录下</p><p>仓库中也有相应的 <code>API</code> 的使用方法</p><p>之后点击工程根目录配置，在 <code>General</code> 中找到 <code>Frameworks, Libraries, and Embedded Content</code></p><p>点 <code>+</code> 然后找到 <code>SWViewCapture.framework</code> 添加</p><p>重新进行一下编译，就能直接导入了</p><p><code>import SwViewCapture</code></p><p>接下来是同样的操作，但是 <code>SWViewCapture</code> 类库中已经封装好了截图功能，我们只需要直接调用给出的接口就好</p><p>将 <code>takescreenShot</code> 修改如下，在第 5-8 行调用了 <code>takescreenShot</code> 的接口</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">func takescreenShot (_ shouldSave: Bool = false) -&gt; UIImage? {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var screenshotImage: UIImage?</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    webView.swCapture { (capturedImage) -&gt; Void in</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        screenshotImage = capturedImage</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if let image = screenshotImage, shouldSave {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        UIImageWriteToSavedPhotosAlbum(image, nil, nil, nil)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    return screenshotImage</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>完成之后测试，果然是因为相册权限的问题导致崩溃</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>s</h5></div><div class="admonition-content"><p><code>ios</code> 的开发过程中，很需要注意不同版本之间的 API 的兼容性，官方的帮助文档中大部分都能找到需要的帮助</p><p>GitHub 也是很需要经常浏览的地方，开源永远的神</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="保存截图"></a>保存截图<a class="hash-link" href="#保存截图" title="Direct link to heading">#</a></h3><p><code>UIImageWriteToSavedPhotosAlbum()</code> 可以将 <code>UIImage</code> 保存到相册中，这里可以通过一些方法修改想要保存的图片格式</p><p>通过给 <code>UIImage</code> 增加拓展功能，可以很方便的设定想要导出的图像格式</p><ul><li>拓展名要声明在全局</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-swift codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">extension UIImage {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    func toPNG() -&gt; UIImage? {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        guard let imageData = self.pngData() else {return nil}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        guard let imagePng = UIImage(data: imageData) else {return nil}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        return imagePng</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>如果需要导出 <code>jpeg</code> 格式的图片</p><p>则可以将</p><p><strong><code>guard let imageData = self.pngData() else {return nil}</code></strong></p><p>改为</p><p><strong><code>guard let imageData = self.jpegData(compressionQuality: 1.0) else {return nil}</code></strong></p><p>变量名稍作修改即可</p><p>使用时直接使用 <code>UIImage</code> 中的拓展方法即可</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="本项目源码"></a>本项目源码<a class="hash-link" href="#本项目源码" title="Direct link to heading">#</a></h3><p>待整理······</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="参考"></a>参考<a class="hash-link" href="#参考" title="Direct link to heading">#</a></h2><ul><li><a href="https://developer.apple.com/forums/thread/89796" target="_blank" rel="noopener noreferrer">UIImageWriteToSavedPhotosAlbum crashed in iOS 11</a></li><li><a href="https://stackoverflow.com/questions/25448879/how-do-i-take-a-full-screen-screenshot-in-swift" target="_blank" rel="noopener noreferrer">How do I take a full screen Screenshot in Swift?</a></li><li><a href="https://github.com/fzhlee/SwiftUI-Guide#11Button-sheet" target="_blank" rel="noopener noreferrer">SwiftUI-Guide</a></li><li><a href="https://www.hangge.com/blog/cache/detail_2114.html" target="_blank" rel="noopener noreferrer">Swift - 截图功能的实现2</a></li><li><a href="https://github.com/startry/SwViewCapture" target="_blank" rel="noopener noreferrer">startry/SwViewCapture</a></li><li><a href="https://www.hackingwithswift.com/example-code/media/how-to-save-a-uiimage-to-a-file-using-jpegdata-and-pngdata" target="_blank" rel="noopener noreferrer">How to save a UIImage to a file using jpegData() and pngData()</a></li><li><a href="https://stackoverflow.com/questions/1489250/uiimagewritetosavedphotosalbum-save-as-png-with-transparency" target="_blank" rel="noopener noreferrer">UIImageWriteToSavedPhotosAlbum save as PNG with transparency?</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/rcxxx/docs/tree/master/docs/ios/swiftUI/screen-shot.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/docs/ios/swiftUI/swiftUI-show-web-pages"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« swiftUI 显示网页内容</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/docs/ios/swiftUI/swiftUI-ReplayKit"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">swiftUI 实现录屏 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#测试环境" class="table-of-contents__link">测试环境</a></li><li><a href="#功能实现" class="table-of-contents__link">功能实现</a></li><li><a href="#方案二" class="table-of-contents__link">方案二</a></li><li><a href="#保存截图" class="table-of-contents__link">保存截图</a></li><li><a href="#本项目源码" class="table-of-contents__link">本项目源码</a></li><li><a href="#参考" class="table-of-contents__link">参考</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://sinnammanyo.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">My Blog</a></li><li class="footer__item"><a href="https://github.com/rcxxx" target="_blank" rel="noopener noreferrer" class="footer__link-item">My GitHub</a></li><li class="footer__item"><a href="https://wiki.wildwolf.tech/" target="_blank" rel="noopener noreferrer" class="footer__link-item">机器人队知识库</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 🌈RCXXX. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs/styles.5cb6a75a.js"></script>
<script src="/docs/runtime~main.eb589c99.js"></script>
<script src="/docs/main.d8999595.js"></script>
<script src="/docs/1.5de7ee7f.js"></script>
<script src="/docs/2.cda0db80.js"></script>
<script src="/docs/111.bd71c2f7.js"></script>
<script src="/docs/113.9931715d.js"></script>
<script src="/docs/935f2afb.daa1501e.js"></script>
<script src="/docs/17896441.110d4dda.js"></script>
<script src="/docs/d6e0f890.9dee84b1.js"></script>
</body>
</html>